#  Задание

##  Зюзин Георгий

## УлГТУ, ФИСТ, ИВТАСбд-31

## Задание - [https://drive.google.com/file/d/1nTTSmdbbJPnTCC3_Pi0oeIc5oFXFW0K2/view](https://drive.google.com/file/d/1nTTSmdbbJPnTCC3_Pi0oeIc5oFXFW0K2/view)

## Описание проекта

Реализовать сервис, который принимает и отвечает на HTTP запросы.

#### Функционал:

1. В случае успешной обработки сервис должен отвечать статусом 200, в случае любой ошибки — статус 400.
2. Сохранение всех объектов в базе данных.
3. Запросы:
   - GET /city/ — получение всех городов из базы;
   - GET /city/{city_id}/street/ — получение всех улиц города; {city_id — идентификатор города}
   - POST /shop/ — создание магазина; Данный метод получает json с объектом магазина, в ответ возвращает id созданной записи.
   - GET /shop/?street=&city=&open=0/1 — получение списка магазинов;
     - Метод принимает параметры для фильтрации. Параметры не обязательны. В случае отсутствия параметров выводятся все магазины, если хоть один параметр есть, то по нему выполняется фильтрация.
     - Важно! В объекте каждого магазина выводится название города и улицы, а не id записей.
     - Параметр open: 0 - закрыт, 1 - открыт. Данный статус определяется исходя из параметров "Время открытия", "Время закрытия" и текущего времени сервера.

#### Объекты:

**Магазин:**
- Название
- Город
- Улица
- Дом
- Время открытия
- Время закрытия

**Город:**
- Название

**Улица:**
- Название
- Город

_Замечание: поле id у объектов не указаны, но подразумевается, что они есть._

_Важно: Выстроить связи между таблицами в базе данных._

#### Инструменты:

- Фреймворк для обработки http запросов Django + Django Rest Framework
- Реляционная БД (PostgreSQL - предпочтительно, MySQL и тд)
- Запросы в базу данных через ORM (ORM на выбор).

#### Сдача задания:

Ссылка на репозиторий, который содержит ваш проект и README:
- Фамилия Имя
- Тестовое задание Python
- Описание проекта
- Подготовительные действия (установки, настройки и т.д.) для успешной работы проекта*
- Информация о доступах (логины/пароли и т.д.)
- Описание, как запустить проект

# Запуск проекта
Чтобы подключиться к базе данных необходимо использовать платформу. Как это сделать, будет показано на примере pgAdmin4.
В проекте параметры подключения выглядят так:
```
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'my_db',
        'USER': 'postgres',
        'PASSWORD': 'admin',
        'HOST': 'localhost',
        'PORT': '5432',

    }
}
```
Если настройки вашей платформы отличаются, то изменяем параметры тут в файле setting.py проекта.
В данном случае мы коннектимся к БД `my_db`, имя пользовтеля - `postgres`, пароль -  `admin`, `localhost` с портом `5432`.

В pgAdmin создаём БД `my_db`.

![image](https://github.com/zh0rchik/TestingTask/assets/99082375/3fece1c5-940d-40bd-a84e-5196b424d760)
![image](https://github.com/zh0rchik/TestingTask/assets/99082375/17cf2db2-09fe-4c1e-ba4a-bd734a51912c)

Вызываем контекстное меню, выбираем `Restore`.

![image](https://github.com/zh0rchik/TestingTask/assets/99082375/e5501691-8596-4e31-b241-ff803ea5b70d)

Указываем путь к файлу БД, которая прикреплена в данном репозитории, и выбираем `Restore`. (Примечение (вроде как не обязательно): 
`Role name` : `postgres`)

![image](https://github.com/zh0rchik/TestingTask/assets/99082375/7d2ab801-7fc9-4788-8880-40c66fc0ff1f)

 Теперь можно подсоединяться к базе данных. Чтобы запустить сервер, в терминале из директории проекта выполняем команду:
```
python manage.py runserver
```

### Данные авторизации суперпользователя:
Login: admin

Email: admin@mail.ru

Password: admin


# Тестирование
Запросы `GET`:

[http://127.0.0.1:8000/city/](http://127.0.0.1:8000/city/) - Получение всех городов из базы;

[http://127.0.0.1:8000/city/0/](http://127.0.0.1:8000/city/0/) - Получение всех улиц города (В данном случае все улицы Ульяновска); 

### Фильтрация магазинов

[http://127.0.0.1:8000/shop/?city=Москва&open=0](http://127.0.0.1:8000/shop/?city=Москва&open=0) - Получение всех ЗАКРЫТЫХ магазинов Москвы

[http://127.0.0.1:8000/shop/?city=Москва&open=1](http://127.0.0.1:8000/shop/?city=Москва&open=1) - Получение всех ОТКРЫТЫХ магазинов Москвы

Запросы `POST`:

[http://127.0.0.1:8000/shop/](http://127.0.0.1:8000/shop/) - Cоздание магазина. Данный метод получает json.

 Пример создание магазина:

```
{
        "shop_name": "Волга",
        "city": 3,
        "street": 11,
        "home": "3",
        "open_time": "09:00:00",
        "close_time": "21:00:00"
}
```

Как отображается json после добавления:
```
{
        "shop_name": "Волга",
        "city": "Самара",
        "street": "Гагарина",
        "home": "3",
        "open_time": "09:00:00",
        "close_time": "21:00:00"
}
```

Вот что происходит, если попытаться добавить улицу, которой в городе нет. ~~Это неправильный json~~ :
```
{
        "shop_name": "Волга",
        "city": 0,
        "street": 11,
        "home": "3",
        "open_time": "09:00:00",
        "close_time": "21:00:00"
}
```
 Результат:
```
HTTP 400 Bad Request
Allow: GET, POST, HEAD, OPTIONS
Content-Type: application/json
Vary: Accept

{
    "non_field_errors": [
        "Этой улицы нет в данном городе"
    ]
}
```
